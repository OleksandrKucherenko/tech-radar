<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>Tech Radar Builder - Create Your Own Technology Radar</title>
    <meta name="title" content="Tech Radar Builder - Create Your Own Technology Radar">
    <meta name="description"
        content="Interactive Tech Radar Builder tool. Create, customize, and export your own technology radar with drag-and-drop interface. Configure quadrants, rings, and visualize technology choices.">
    <meta name="keywords"
        content="tech radar builder, technology radar creator, interactive tool, radar generator, visualization builder">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oleksandrkucherenko.github.io/tech-radar/builder.html">
    <meta property="og:title" content="Tech Radar Builder - Create Your Own Technology Radar">
    <meta property="og:description"
        content="Interactive Tech Radar Builder tool. Create, customize, and export your own technology radar with drag-and-drop interface. Configure quadrants, rings, and visualize technology choices.">
    <meta property="og:image"
        content="https://oleksandrkucherenko.github.io/tech-radar/screenshots/4x8-quadrants-rings.jpg">
    <meta property="og:site_name" content="Tech Radar">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://oleksandrkucherenko.github.io/tech-radar/builder.html">
    <meta name="twitter:title" content="Tech Radar Builder - Create Your Own Technology Radar">
    <meta name="twitter:description"
        content="Interactive Tech Radar Builder tool. Create, customize, and export your own technology radar with drag-and-drop interface. Configure quadrants, rings, and visualize technology choices.">
    <meta name="twitter:image"
        content="https://oleksandrkucherenko.github.io/tech-radar/screenshots/4x8-quadrants-rings.jpg">

    <!-- Repository & Links -->
    <link rel="canonical" href="https://oleksandrkucherenko.github.io/tech-radar/builder.html">
    <link rel="repository" href="https://github.com/OleksandrKucherenko/tech-radar">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="Tech Radar">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#1976d2">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="radar.js"></script>
    <link rel="stylesheet" href="radar.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: #fff;
            border-bottom: 2px solid #1976d2;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #1976d2;
            font-size: 1.6rem;
            margin-bottom: 0.3rem;
        }

        .header p {
            color: #666;
            font-size: 0.9rem;
        }

        .demo-toolbar {
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            padding: 0.75rem 1.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
        }

        .demo-toolbar__controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .demo-toolbar__button {
            background: #1976d2;
            border: none;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .demo-toolbar__button:hover {
            background: #1565c0;
        }

        .demo-toolbar__message {
            font-size: 0.85rem;
            color: #1976d2;
            min-height: 1rem;
            flex: 1;
        }

        .demo-toolbar__message[data-state="error"] {
            color: #d32f2f;
        }

        .demo-toolbar__message[data-state="success"] {
            color: #2e7d32;
        }

        .container {
            display: grid;
            grid-template-columns: 320px 1fr 380px;
            gap: 1.5rem;
            padding: 1.5rem;
            height: calc(100vh - 100px);
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
        }

        .center-column {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
        }

        .section {
            background: #fff;
            border-radius: 8px;
            padding: 1.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #1976d2;
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            padding-bottom: 0.4rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: #555;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
        }

        .btn {
            padding: 0.7rem 1.2rem;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1976d2;
            color: white;
        }

        .btn-primary:hover {
            background: #1565c0;
        }

        .btn-secondary {
            background: #757575;
            color: white;
        }

        .btn-secondary:hover {
            background: #616161;
        }

        .btn-success {
            background: #388e3c;
            color: white;
        }

        .btn-success:hover {
            background: #2e7d32;
        }

        .btn-danger {
            background: #d32f2f;
            color: white;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        .btn-danger:hover {
            background: #c62828;
        }

        .btn-warning {
            background: #f57c00;
            color: white;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        .btn-warning:hover {
            background: #ef6c00;
        }

        .btn-group {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .btn-full {
            width: 100%;
        }

        .entries-list {
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .entry-item {
            background: #f5f5f5;
            padding: 0.8rem;
            margin-bottom: 0.6rem;
            border-radius: 4px;
            border-left: 4px solid #1976d2;
        }

        .entry-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.4rem;
        }

        .entry-item-title {
            font-weight: 600;
            color: #333;
        }

        .entry-item-actions {
            display: flex;
            gap: 0.4rem;
        }

        .entry-item-details {
            font-size: 0.85rem;
            color: #666;
        }

        .radar-container {
            min-height: 800px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .code-block {
            background: #263238;
            color: #aed581;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .copy-btn:hover {
            background: #1565c0;
        }

        .copy-btn.copied {
            background: #388e3c;
        }

        .alert {
            padding: 0.8rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #1976d2;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .preset-btn {
            padding: 0.5rem;
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            text-align: center;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: #bbdefb;
        }

        .ring-selector {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .ring-option {
            flex: 1;
            padding: 0.6rem;
            background: #e3f2fd;
            border: 2px solid #90caf9;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.2s;
        }

        .ring-option.active {
            background: #1976d2;
            color: white;
            border-color: #1976d2;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #999;
        }

        @media (max-width: 1400px) {
            .container {
                grid-template-columns: 280px 1fr 340px;
            }
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .left-column,
            .center-column,
            .right-column {
                overflow-y: visible;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Tech Radar Builder</h1>
        <p>Create, customize, and share your technology radar. Configure quadrants, add entries, and generate embeddable
            code for Confluence or web pages.</p>
    </div>
    <div class="demo-toolbar" role="region" aria-label="JSON configuration tools">
        <div class="demo-toolbar__controls">
            <button type="button" class="demo-toolbar__button" id="jsonImportButton">Import JSON</button>
            <button type="button" class="demo-toolbar__button" id="jsonExportButton">Export JSON</button>
            <input type="file" id="jsonImportInput" accept="application/json,.json" hidden>
        </div>
        <p class="demo-toolbar__message" id="jsonToolbarMessage" role="status" aria-live="polite"></p>
    </div>

    <div class="container">
        <!-- Left Column: Configuration & Share/Export -->
        <div class="left-column">
            <div class="section">
                <h2>Configuration</h2>

                <div class="form-group">
                    <label>Number of Rings</label>
                    <div class="ring-selector">
                        <div class="ring-option active" data-rings="4">4 Rings</div>
                        <div class="ring-option" data-rings="7">7 Rings</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Number of Quadrants (2-8)</label>
                    <input type="number" id="quadrantCount" min="2" max="8" value="4">
                </div>

                <div class="form-group">
                    <label>Presets</label>
                    <div class="preset-buttons">
                        <div class="preset-btn" data-preset="classic">Classic (4Q)</div>
                        <div class="preset-btn" data-preset="software">Software (4Q)</div>
                        <div class="preset-btn" data-preset="data">Data & AI (4Q)</div>
                        <div class="preset-btn" data-preset="security">Security (4Q)</div>
                        <div class="preset-btn" data-preset="cloud">Cloud (3Q)</div>
                        <div class="preset-btn" data-preset="devops">DevOps (4Q)</div>
                    </div>
                </div>

                <div id="quadrantNamesContainer"></div>

                <div class="btn-group">
                    <button class="btn btn-secondary btn-full" id="resetBtn">Reset All</button>
                </div>
            </div>

            <div class="section">
                <h2>Share & Export</h2>

                <div class="btn-group">
                    <button class="btn btn-primary btn-full" id="shareUrlBtn">Copy Share URL</button>
                </div>

                <div class="btn-group" style="margin-top: 0.5rem;">
                    <button class="btn btn-success btn-full" id="exportCodeBtn">Generate Embed Code</button>
                </div>

                <div class="btn-group" style="margin-top: 0.5rem;">
                    <button class="btn btn-secondary btn-full" id="exportPngBtn">Download as PNG</button>
                </div>

                <div class="btn-group" style="margin-top: 0.5rem;">
                    <button class="btn btn-secondary btn-full" id="exportPdfBtn">Download as PDF</button>
                </div>

                <div id="embedCodeSection" style="display: none; margin-top: 1rem;">
                    <h3 style="margin-bottom: 0.5rem;">Embed Code</h3>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.8rem;">
                        Copy and paste this code into your web page or Confluence page.
                        For Confluence, use the "HTML Macro" or paste in source editor mode.
                    </p>
                    <div style="position: relative;">
                        <button class="copy-btn" id="copyCodeBtn">Copy</button>
                        <div class="code-block" id="embedCode"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Column: Preview -->
        <div class="center-column">
            <div class="section" style="flex: 1; display: flex; flex-direction: column;">
                <h2>Preview</h2>
                <div class="radar-container" id="radarContainer" style="flex: 1;">
                    <svg id="radar"></svg>
                </div>
            </div>
        </div>

        <!-- Right Column: Add Entry & Entries List -->
        <div class="right-column">
            <div class="section">
                <h2>Add Entry</h2>

                <div class="form-group">
                    <label>Technology Name *</label>
                    <input type="text" id="entryLabel" placeholder="e.g., React, PostgreSQL">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Quadrant *</label>
                        <select id="entryQuadrant"></select>
                    </div>

                    <div class="form-group">
                        <label>Ring *</label>
                        <select id="entryRing"></select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Status</label>
                        <select id="entryMoved">
                            <option value="0">No Change</option>
                            <option value="2">New</option>
                            <option value="1">Moved In</option>
                            <option value="-1">Moved Out</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Active</label>
                        <select id="entryActive">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Link (Optional)</label>
                    <input type="url" id="entryLink" placeholder="https://...">
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-full" id="addEntryBtn">Add Entry</button>
                </div>

                <div id="editingAlert" class="alert alert-info" style="display: none; margin-top: 1rem;">
                    Editing entry. Click "Update Entry" to save changes or "Cancel" to discard.
                    <button class="btn btn-secondary" id="cancelEditBtn"
                        style="margin-top: 0.5rem; width: 100%;">Cancel</button>
                </div>
            </div>

            <div class="section">
                <h2>Entries (<span id="entryCount">0</span>)</h2>
                <div class="entries-list" id="entriesList">
                    <div class="empty-state">No entries yet. Add your first technology!</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const jsonIOHelpers = window.radar_visualization && window.radar_visualization.jsonIO;
        if (!jsonIOHelpers) {
            console.warn('radar_visualization.jsonIO is unavailable. JSON import/export helpers will be disabled.');
        }
        const { exportConfig, importConfig } = jsonIOHelpers || {};
        // State management
        const state = {
            ringCount: 4,
            quadrantCount: 4,
            quadrantNames: ['Languages', 'Infrastructure', 'Datastores', 'Data Management'],
            ringNames: ['ADOPT', 'TRIAL', 'ASSESS', 'HOLD'],
            entries: [],
            editingIndex: -1
        };

        // Ring configurations
        const RING_CONFIGS = {
            4: {
                names: ['ADOPT', 'TRIAL', 'ASSESS', 'HOLD'],
                colors: ['#5ba300', '#009eb0', '#c7ba00', '#e09b96']
            },
            7: {
                names: ['ADOPT', 'TRIAL', 'ASSESS', 'HOLD', 'DEPRECATED', 'REJECTED', 'ARCHIVED'],
                colors: ['#5ba300', '#009eb0', '#c7ba00', '#e09b96', '#cc6699', '#993333', '#666666']
            }
        };

        // Preset configurations
        const PRESETS = {
            classic: {
                quadrants: ['Languages', 'Infrastructure', 'Datastores', 'Data Management']
            },
            software: {
                quadrants: ['Frontend', 'Backend', 'DevOps & Tools', 'Mobile']
            },
            data: {
                quadrants: ['Data Platforms', 'ML & AI', 'Analytics', 'Data Governance']
            },
            security: {
                quadrants: ['Application Security', 'Infrastructure Security', 'Identity & Access', 'Compliance']
            },
            cloud: {
                quadrants: ['Compute', 'Storage', 'Services']
            },
            devops: {
                quadrants: ['CI/CD', 'Infrastructure as Code', 'Monitoring', 'Collaboration']
            }
        };

        const demoSlug = 'builder';
        let jsonToolbarMessageEl = null;
        let toolbarMessageTimer = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadFromLocalStorage();
            loadFromURL();
            setupEventListeners();
            updateUI();
            renderRadar();
            initializeJsonToolbar();
        });

        function initializeJsonToolbar() {
            const importButton = document.getElementById('jsonImportButton');
            const exportButton = document.getElementById('jsonExportButton');
            const importInput = document.getElementById('jsonImportInput');
            jsonToolbarMessageEl = document.getElementById('jsonToolbarMessage');

            if (!exportConfig || !importConfig) {
                if (jsonToolbarMessageEl) {
                    jsonToolbarMessageEl.textContent = 'JSON helpers unavailable.';
                    jsonToolbarMessageEl.dataset.state = 'error';
                }
                return;
            }

            if (!importButton || !exportButton || !importInput) {
                console.warn('JSON toolbar is missing required elements.');
                return;
            }

            importButton.addEventListener('click', () => importInput.click());

            importConfig(importInput, applyImportedConfig, {
                demoSlug,
                onSuccess: ({ fileName }) => {
                    showToolbarMessage(`Imported ${fileName || 'configuration'} successfully`, 'success');
                },
                onError: (message) => {
                    console.error(message);
                    showToolbarMessage(message, 'error');
                }
            });

            exportConfig(exportButton, () => buildVisualizationConfigFromState(), {
                demoSlug,
                onSuccess: ({ fileName }) => {
                    showToolbarMessage(`Exported ${fileName}`, 'success');
                },
                onError: (message) => {
                    console.error(message);
                    showToolbarMessage(message, 'error');
                }
            });
        }

        function showToolbarMessage(message = '', state = '') {
            if (!jsonToolbarMessageEl) {
                return;
            }

            if (toolbarMessageTimer) {
                clearTimeout(toolbarMessageTimer);
            }

            jsonToolbarMessageEl.textContent = message;
            if (state) {
                jsonToolbarMessageEl.dataset.state = state;
            } else {
                delete jsonToolbarMessageEl.dataset.state;
            }

            if (message) {
                toolbarMessageTimer = window.setTimeout(() => {
                    jsonToolbarMessageEl.textContent = '';
                    delete jsonToolbarMessageEl.dataset.state;
                }, 4000);
            }
        }

        function setupEventListeners() {
            // Ring selector
            document.querySelectorAll('.ring-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.ring-option').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.ringCount = parseInt(btn.dataset.rings, 10);
                    state.ringNames = RING_CONFIGS[state.ringCount].names;
                    updateUI();
                    renderRadar();
                    saveToLocalStorage();
                });
            });

            // Quadrant count
            document.getElementById('quadrantCount').addEventListener('change', (e) => {
                const count = parseInt(e.target.value, 10);
                if (count >= 2 && count <= 8) {
                    state.quadrantCount = count;
                    // Adjust quadrant names array
                    if (state.quadrantNames.length > count) {
                        state.quadrantNames = state.quadrantNames.slice(0, count);
                    } else {
                        while (state.quadrantNames.length < count) {
                            state.quadrantNames.push(`Quadrant ${state.quadrantNames.length + 1}`);
                        }
                    }
                    updateUI();
                    renderRadar();
                    saveToLocalStorage();
                }
            });

            // Preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const preset = PRESETS[btn.dataset.preset];
                    state.quadrantCount = preset.quadrants.length;
                    state.quadrantNames = [...preset.quadrants];
                    document.getElementById('quadrantCount').value = state.quadrantCount;
                    updateUI();
                    renderRadar();
                    saveToLocalStorage();
                });
            });

            // Add/Update entry
            document.getElementById('addEntryBtn').addEventListener('click', addOrUpdateEntry);

            // Cancel edit
            document.getElementById('cancelEditBtn').addEventListener('click', cancelEdit);

            // Reset
            document.getElementById('resetBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset everything? This will clear all entries and reset configuration.')) {
                    state.ringCount = 4;
                    state.quadrantCount = 4;
                    state.quadrantNames = ['Languages', 'Infrastructure', 'Datastores', 'Data Management'];
                    state.ringNames = RING_CONFIGS[4].names;
                    state.entries = [];
                    state.editingIndex = -1;
                    document.getElementById('quadrantCount').value = 4;
                    document.querySelectorAll('.ring-option').forEach(b => b.classList.remove('active'));
                    document.querySelector('.ring-option[data-rings="4"]').classList.add('active');
                    updateUI();
                    renderRadar();
                    saveToLocalStorage();
                }
            });

            // Share URL
            document.getElementById('shareUrlBtn').addEventListener('click', copyShareURL);

            // Export code
            document.getElementById('exportCodeBtn').addEventListener('click', generateEmbedCode);

            // Copy code
            document.getElementById('copyCodeBtn').addEventListener('click', copyEmbedCode);

            // Export PNG
            document.getElementById('exportPngBtn').addEventListener('click', exportToPNG);

            // Export PDF
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);

        }

        function updateUI() {
            // Update quadrant name inputs
            const container = document.getElementById('quadrantNamesContainer');
            container.innerHTML = '';

            for (let i = 0; i < state.quadrantCount; i++) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>Quadrant ${i + 1} Name</label>
                    <input type="text" class="quadrant-name-input" data-index="${i}" value="${state.quadrantNames[i] || `Quadrant ${i + 1}`}">
                `;
                container.appendChild(div);
            }

            // Add event listeners to quadrant name inputs
            document.querySelectorAll('.quadrant-name-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = parseInt(e.target.dataset.index, 10);
                    state.quadrantNames[index] = e.target.value;
                    updateQuadrantDropdown();
                    renderRadar();
                    saveToLocalStorage();
                });
            });

            updateQuadrantDropdown();
            updateRingDropdown();
            updateEntriesList();
        }

        function updateQuadrantDropdown() {
            const select = document.getElementById('entryQuadrant');
            const currentValue = select.value;
            select.innerHTML = '';

            for (let i = 0; i < state.quadrantCount; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = state.quadrantNames[i];
                select.appendChild(option);
            }

            if (currentValue !== '' && parseInt(currentValue, 10) < state.quadrantCount) {
                select.value = currentValue;
            }
        }

        function updateRingDropdown() {
            const select = document.getElementById('entryRing');
            const currentValue = select.value;
            select.innerHTML = '';

            for (let i = 0; i < state.ringCount; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = state.ringNames[i];
                select.appendChild(option);
            }

            if (currentValue !== '' && parseInt(currentValue, 10) < state.ringCount) {
                select.value = currentValue;
            }
        }

        function updateEntriesList() {
            const list = document.getElementById('entriesList');
            const count = document.getElementById('entryCount');

            count.textContent = state.entries.length;

            if (state.entries.length === 0) {
                list.innerHTML = '<div class="empty-state">No entries yet. Add your first technology!</div>';
                return;
            }

            list.innerHTML = state.entries.map((entry, index) => `
                <div class="entry-item">
                    <div class="entry-item-header">
                        <div class="entry-item-title">${entry.label}</div>
                        <div class="entry-item-actions">
                            <button class="btn btn-warning" onclick="editEntry(${index})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteEntry(${index})">Delete</button>
                        </div>
                    </div>
                    <div class="entry-item-details">
                        ${state.quadrantNames[entry.quadrant]} • ${state.ringNames[entry.ring]}
                        ${entry.moved === 2 ? ' • New' : entry.moved === 1 ? ' • Moved In' : entry.moved === -1 ? ' • Moved Out' : ''}
                        ${!entry.active ? ' • Inactive' : ''}
                    </div>
                </div>
            `).join('');
        }

        function addOrUpdateEntry() {
            const label = document.getElementById('entryLabel').value.trim();
            const quadrant = parseInt(document.getElementById('entryQuadrant').value, 10);
            const ring = parseInt(document.getElementById('entryRing').value, 10);
            const moved = parseInt(document.getElementById('entryMoved').value, 10);
            const active = document.getElementById('entryActive').value === 'true';
            const link = document.getElementById('entryLink').value.trim();

            if (!label) {
                alert('Please enter a technology name');
                return;
            }

            const entry = {
                label,
                quadrant,
                ring,
                moved,
                active,
                link: link || undefined
            };

            if (state.editingIndex >= 0) {
                // Update existing entry
                state.entries[state.editingIndex] = entry;
                state.editingIndex = -1;
                document.getElementById('addEntryBtn').textContent = 'Add Entry';
                document.getElementById('editingAlert').style.display = 'none';
            } else {
                // Add new entry
                state.entries.push(entry);
            }

            // Clear form
            document.getElementById('entryLabel').value = '';
            document.getElementById('entryMoved').value = '0';
            document.getElementById('entryActive').value = 'true';
            document.getElementById('entryLink').value = '';

            updateEntriesList();
            renderRadar();
            saveToLocalStorage();
        }

        function _editEntry(index) {
            const entry = state.entries[index];
            state.editingIndex = index;

            document.getElementById('entryLabel').value = entry.label;
            document.getElementById('entryQuadrant').value = entry.quadrant;
            document.getElementById('entryRing').value = entry.ring;
            document.getElementById('entryMoved').value = entry.moved;
            document.getElementById('entryActive').value = entry.active;
            document.getElementById('entryLink').value = entry.link || '';

            document.getElementById('addEntryBtn').textContent = 'Update Entry';
            document.getElementById('editingAlert').style.display = 'block';

            // Scroll to form
            document.querySelector('.sidebar').scrollTop = 0;
        }

        function cancelEdit() {
            state.editingIndex = -1;
            document.getElementById('addEntryBtn').textContent = 'Add Entry';
            document.getElementById('editingAlert').style.display = 'none';

            // Clear form
            document.getElementById('entryLabel').value = '';
            document.getElementById('entryMoved').value = '0';
            document.getElementById('entryActive').value = 'true';
            document.getElementById('entryLink').value = '';
        }

        function _deleteEntry(index) {
            if (confirm('Are you sure you want to delete this entry?')) {
                state.entries.splice(index, 1);
                updateEntriesList();
                renderRadar();
                saveToLocalStorage();
            }
        }

        function renderRadar() {
            const container = document.getElementById('radarContainer');
            container.innerHTML = '<svg id="radar"></svg>';

            if (state.entries.length === 0) {
                container.innerHTML = '<div class="empty-state">Add entries to see your radar visualization</div>';
                return;
            }

            try {
                // Convert state format to radar_visualization format
                const quadrants = state.quadrantNames.map(name => ({ name }));
                const rings = state.ringNames.map((name, index) => ({
                    name,
                    color: RING_CONFIGS[state.ringCount].colors[index]
                }));

                radar_visualization({
                    svg_id: 'radar',
                    width: 1000,
                    height: 800,
                    quadrants: quadrants,
                    rings: rings,
                    colors: {
                        background: '#fff',
                        grid: '#dddde0',
                        inactive: '#ddd'
                    },
                    title: 'Technology Radar',
                    entries: state.entries
                });
            } catch (error) {
                console.error('Error rendering radar:', error);
                container.innerHTML = `<div class="empty-state" style="color: #d32f2f;">Error rendering radar: ${error.message}</div>`;
            }
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('techRadarBuilder', JSON.stringify(state));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('techRadarBuilder');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    Object.assign(state, parsed);
                    state.editingIndex = -1; // Reset editing state

                    // Update UI to match loaded state
                    document.getElementById('quadrantCount').value = state.quadrantCount;
                    document.querySelectorAll('.ring-option').forEach(b => b.classList.remove('active'));
                    document.querySelector(`.ring-option[data-rings="${state.ringCount}"]`).classList.add('active');
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
            }
        }

        function encodeStateToURL() {
            // Clean entries - only include data properties
            const cleanEntries = state.entries.map(entry => {
                const clean = {
                    label: entry.label,
                    quadrant: entry.quadrant,
                    ring: entry.ring,
                    moved: entry.moved,
                    active: entry.active
                };
                if (entry.link) clean.link = entry.link;
                return clean;
            });

            const config = {
                r: state.ringCount,
                q: state.quadrantCount,
                qn: state.quadrantNames,
                e: cleanEntries
            };
            const encoded = btoa(JSON.stringify(config));
            return `${window.location.origin}${window.location.pathname}#${encoded}`;
        }

        function loadFromURL() {
            const hash = window.location.hash.substring(1);
            if (!hash) return;

            try {
                const decoded = JSON.parse(atob(hash));
                state.ringCount = decoded.r || 4;
                state.quadrantCount = decoded.q || 4;
                state.quadrantNames = decoded.qn || state.quadrantNames;
                state.ringNames = RING_CONFIGS[state.ringCount].names;
                state.entries = decoded.e || [];

                // Update UI
                document.getElementById('quadrantCount').value = state.quadrantCount;
                document.querySelectorAll('.ring-option').forEach(b => b.classList.remove('active'));
                document.querySelector(`.ring-option[data-rings="${state.ringCount}"]`).classList.add('active');

                saveToLocalStorage();
            } catch (error) {
                console.error('Error loading from URL:', error);
            }
        }

        function copyShareURL() {
            const url = encodeStateToURL();
            navigator.clipboard.writeText(url).then(() => {
                const btn = document.getElementById('shareUrlBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#388e3c';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(_err => {
                alert(`Failed to copy URL. Please copy manually: ${url}`);
            });
        }

        function generateEmbedCode() {
            // Convert state format to radar_visualization format
            const quadrants = state.quadrantNames.map(name => ({ name }));
            const rings = state.ringNames.map((name, index) => ({
                name,
                color: RING_CONFIGS[state.ringCount].colors[index]
            }));

            // Clean entries - only include data properties, not computed D3.js properties
            const cleanEntries = state.entries.map(entry => {
                const clean = {
                    label: entry.label,
                    quadrant: entry.quadrant,
                    ring: entry.ring,
                    moved: entry.moved,
                    active: entry.active
                };
                if (entry.link) {
                    clean.link = entry.link;
                }
                return clean;
            });

            const _config = {
                svg_id: 'radar',
                width: 1000,
                height: 800,
                quadrants: quadrants,
                rings: rings,
                colors: {
                    background: '#fff',
                    grid: '#dddde0',
                    inactive: '#ddd'
                },
                title: 'Technology Radar',
                entries: cleanEntries
            };

            const _code = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Technology Radar</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://raw.githubusercontent.com/OleksandrKucherenko/tech-radar/main/docs/radar.js"></script>
    <link rel="stylesheet" href="https://raw.githubusercontent.com/OleksandrKucherenko/tech-radar/main/docs/radar.css">
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, Helvetica, sans-serif; }
        #radar-container { display: flex; justify-content: center; }
    </style>
</head>
<body>
    <div id="radar-container">
        <svg id="radar"></svg>
    </div>

    <script>
        radar_visualization(${JSON.stringify(config, null, 2)});
    </script>
</body>
</html>`;

            document.getElementById('embedCode').textContent = code;
            document.getElementById('embedCodeSection').style.display = 'block';

            // Scroll to code section
            document.getElementById('embedCodeSection').scrollIntoView({ behavior: 'smooth' });
        }

        function copyEmbedCode() {
            const code = document.getElementById('embedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.getElementById('copyCodeBtn');
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('Failed to copy code. Please copy manually.');
            });
        }

        function exportToPNG() {
            if (state.entries.length === 0) {
                alert('Please add entries before exporting.');
                return;
            }

            const radarContainer = document.getElementById('radarContainer');
            if (!radarContainer) {
                alert('Radar not rendered. Please add entries first.');
                return;
            }

            const btn = document.getElementById('exportPngBtn');
            btn.textContent = 'Generating...';
            btn.disabled = true;

            // Use html2canvas to capture the entire radar including legend
            html2canvas(radarContainer, {
                backgroundColor: '#ffffff',
                scale: 2, // Higher quality
                logging: false
            }).then((canvas) => {
                // Convert to PNG and download
                canvas.toBlob((blob) => {
                    const link = document.createElement('a');
                    link.download = 'tech-radar.png';
                    link.href = URL.createObjectURL(blob);
                    link.click();

                    btn.textContent = 'Download as PNG';
                    btn.disabled = false;
                });
            }).catch((error) => {
                console.error('Export error:', error);
                alert('Failed to export PNG. Please try again.');
                btn.textContent = 'Download as PNG';
                btn.disabled = false;
            });
        }

        function exportToPDF() {
            if (state.entries.length === 0) {
                alert('Please add entries before exporting.');
                return;
            }

            const radarContainer = document.getElementById('radarContainer');
            if (!radarContainer) {
                alert('Radar not rendered. Please add entries first.');
                return;
            }

            const btn = document.getElementById('exportPdfBtn');
            btn.textContent = 'Generating...';
            btn.disabled = true;

            // Use html2canvas to capture the entire radar including legend
            html2canvas(radarContainer, {
                backgroundColor: '#ffffff',
                scale: 2, // Higher quality
                logging: false
            }).then((canvas) => {
                // Convert to data URL
                const imgData = canvas.toDataURL('image/png');

                // Calculate PDF dimensions based on canvas
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;

                // Create PDF using jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: imgWidth > imgHeight ? 'landscape' : 'portrait',
                    unit: 'px',
                    format: [imgWidth, imgHeight]
                });

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save('tech-radar.pdf');

                btn.textContent = 'Download as PDF';
                btn.disabled = false;
            }).catch((error) => {
                console.error('Export error:', error);
                alert('Failed to export PDF. Please try again.');
                btn.textContent = 'Download as PDF';
                btn.disabled = false;
            });
        }

        function buildVisualizationConfigFromState() {
            const cleanEntries = state.entries.map(entry => {
                const clean = {
                    label: entry.label,
                    quadrant: entry.quadrant,
                    ring: entry.ring,
                    moved: entry.moved,
                    active: entry.active
                };
                if (entry.link) {
                    clean.link = entry.link;
                }
                return clean;
            });

            return {
                title: 'Technology Radar',
                quadrants: state.quadrantNames.map(name => ({ name })),
                rings: state.ringNames.map((name, index) => ({
                    name,
                    color: RING_CONFIGS[state.ringCount].colors[index]
                })),
                entries: cleanEntries
            };
        }

        function normalizeImportedConfig(config) {
            let ringCount;
            let quadrantCount;
            let quadrantNames;
            let ringNames;
            let entries;

            if (config.quadrants && Array.isArray(config.quadrants)) {
                quadrantCount = config.quadrants.length;
                quadrantNames = config.quadrants.map(q => q.name);

                if (config.rings && Array.isArray(config.rings)) {
                    ringCount = config.rings.length;
                    ringNames = config.rings.map(r => r.name);
                } else {
                    throw new Error('Invalid configuration: missing rings array.');
                }

                entries = Array.isArray(config.entries) ? config.entries : [];
            } else if (config.ringCount && config.quadrantCount && Array.isArray(config.quadrantNames)) {
                ringCount = config.ringCount;
                quadrantCount = config.quadrantCount;
                quadrantNames = config.quadrantNames;
                const fallbackConfig = RING_CONFIGS[ringCount];
                ringNames = Array.isArray(config.ringNames)
                    ? config.ringNames
                    : (fallbackConfig ? fallbackConfig.names : []);
                entries = Array.isArray(config.entries) ? config.entries : [];
            } else {
                throw new Error('Invalid configuration file format.');
            }

            if (quadrantCount < 2 || quadrantCount > 8) {
                throw new Error('Quadrant count must be between 2 and 8.');
            }

            if (ringCount !== 4 && ringCount !== 7) {
                throw new Error('Only 4 or 7 rings are supported.');
            }

            quadrantNames = quadrantNames.slice(0, quadrantCount);
            while (quadrantNames.length < quadrantCount) {
                quadrantNames.push(`Quadrant ${quadrantNames.length + 1}`);
            }

            const defaultRings = RING_CONFIGS[ringCount] ? RING_CONFIGS[ringCount].names : [];
            ringNames = ringNames.slice(0, ringCount);
            while (ringNames.length < ringCount) {
                ringNames.push(defaultRings[ringNames.length] || `Ring ${ringNames.length + 1}`);
            }

            return {
                ringCount,
                quadrantCount,
                quadrantNames,
                ringNames,
                entries
            };
        }

        function applyImportedConfig(config) {
            const normalized = normalizeImportedConfig(config);

            state.ringCount = normalized.ringCount;
            state.quadrantCount = normalized.quadrantCount;
            state.quadrantNames = [...normalized.quadrantNames];
            state.ringNames = [...normalized.ringNames];
            state.entries = normalized.entries.map(entry => ({ ...entry }));
            state.editingIndex = -1;

            document.getElementById('quadrantCount').value = state.quadrantCount;
            document.querySelectorAll('.ring-option').forEach(b => b.classList.remove('active'));
            const ringBtn = document.querySelector(`.ring-option[data-rings="${state.ringCount}"]`);
            if (ringBtn) {
                ringBtn.classList.add('active');
            }

            updateUI();
            renderRadar();
            saveToLocalStorage();
        }

        // Make functions globally available
        window.editEntry = editEntry;
        window.deleteEntry = deleteEntry;
    </script>
</body>

</html>
